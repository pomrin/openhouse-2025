const { ApiGatewayManagementApiClient, PostToConnectionCommand, GetConnectionCommand } = require("@aws-sdk/client-apigatewaymanagementapi")
exports.handler = async function (event) {
    let connectionInfo;
    let connectionId = event.requestContext.connectionId;
    console.log("Inside Default Handler!");
    const callbackAPI = new ApiGatewayManagementApiClient({
        apiVersion: '2018-11-29',
        endpoint: 'https://' + event.requestContext.domainName + '/' + event.requestContext.stage
    });

    try {
        connectionInfo = await callbackAPI.send(new GetConnectionCommand(
            { ConnectionId: event.requestContext.connectionId }
        ));
    } catch (e) {
        console.log(e);
    }

    connectionInfo.connectionID = connectionId;

    await callbackAPI.send(new PostToConnectionCommand(
        {
            ConnectionId: event.requestContext.connectionId,
            Data:
                'Default Handler. Your info:' +
                JSON.stringify(connectionInfo)
        }
    ));
    return {
        statusCode: 200,
    };
};